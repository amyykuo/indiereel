<% def private_mode_conditional %>
  <% current_user.uid == @user.uid %>
<% end %>

<div class='container'>
  <% if private_mode_conditional %>
    <div class='row-fluid'>
        <small class='pull-right'>
          <%= link_to 'Edit', edit_role_route(@role) %> | 
          <%= link_to 'Delete', role_path(@role), {:method => :delete, :confirm => 'Are you sure you want to delete this role?'} %> | 
          
          <% if !@preview %>
            <%= link_to 'Preview', role_route(@role) + '?preview=true' %>
          <% else %>
            <%= link_to 'View All Fields', role_route(@role) %>
          <% end %>
        </small>
    </div>
  <% end %>
  
  <hr>
  
  <div class='row-fluid'>
    <div class='span3'>
      <h1><%= @role.role_name %></h1>
    </div>
    
    <div class='span6'>
      <h2><%= @role.role_type.capitalize %></h2>
      <dd><%= @role.role_type_description %></dd>
    </div>
    
    <% if @user.roles.length > 1 %>
      <div class='span3'>
        <div class="btn-group pull-right">
          <a class="btn dropdown-toggle btn-mini" data-toggle="dropdown" href="#">Other Roles<span class="caret" /></a>
          
          <ul class="dropdown-menu">
            <% if @preview %>
              <% for role in @user.roles %>
                <%= link_to "#{role.role_type.capitalize}", role_route(role) + '?preview=true' %>
              <% end %>
            <% else %>
              <% for role in @user.roles %>
                <%= link_to "#{role.role_type.capitalize}", role_route(role) %>
              <% end %>
            <% end %>
          </ul>
        </div>
      </div>
    <% end %>
  </div>
  
  <hr>

  <div class="row-fluid">
    <div class="span3">
	    <div class="well">
		    <%= image_tag @role.profile_pic_url, :width => 180, :height => 180 %>
		    
		    <% if private_mode_conditional && !@preview %>
		      <hr>
		      
		      <%= form_for @role do |f| %>
				    <%= f.label "Upload a new profile picture" %>
				    <%= f.file_field :profile_pic %>
				    <%= f.submit "Upload" %>
		      <% end %>
		    <% end %>
	    </div>
    </div>
    
    <div class="span9">
	    <h3>
	      <em>Basic Info</em>
	      
	      <% if private_mode_conditional && !@preview %>
	        <small class="pull-right"><%= link_to "Edit", edit_role_route(@role, "basic-info") %></small>
        <% end %>
      </h3>
	    
	    <hr>
      
      <div class="row-fluid">
        <div class="span6">
	        <section id="attributes">
        	  <h3>Attributes</h3>
        	  
		        <ul class="unstyled">
		          <% for symbolVar, varName in Role.physical_attributes %>
		            <% if private_mode_conditional && !@preview %>
		              <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
		            <% else %>
		              <% unless @role[symbolVar].empty? %>
    		            <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
		              <% end %>
		            <% end %>
	            <% end %>
		        </ul>
	        </section>
	        
	        <section id="living">
	          <h3>Living</h3>
	          
            <ul class="unstyled">
              <% for symbolVar, varName in Role.living_attributes %>
                <% if private_mode_conditional && !@preview %>
	                <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
	              <% else %>
	                <% unless @role[symbolVar].empty? %>
    		            <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
	                <% end %>
	              <% end %>
              <% end %>
	          </ul>
	        </section>
	        
	      </div>
	      
	      <div class="span6">
	        <section id="contact-info">
	          <h3>Contact Information</h3>
	          
	          <ul class="unstyled">
		          <% for symbolVar, varName in Role.contact_attributes %>
		            <% if private_mode_conditional && !@preview %>
		              <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
		            <% else %>
		              <% unless @role[symbolVar].empty? %>
    		            <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
		              <% end %>
		            <% end %>
	            <% end %>
	          </ul>
	        </section>
	        
	        <section id="agency-info">
	          <h3>Agency Information</h3>
	          
	          <ul class="unstyled">
	            <% for symbolVar, varName in Role.agency_attributes %>
		            <% if private_mode_conditional && !@preview %>
		              <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
		            <% else %>
		              <% unless @role[symbolVar].empty? %>
    		            <li><strong><%= varName %>: </strong><%= @role[symbolVar] %></li>
		              <% end %>
		            <% end %>
	            <% end %>
	          </ul>
	        </section>
	      </div>
	    </div>
	    
	    <hr>
	    
	    <div class="row-fluid">
	      <section id="experience">
			      <h3>
			        <em>Experience</em>
			        
			        <% if private_mode_conditional && !@preview %>
			          <small class="pull-right"><%= link_to "Edit", edit_role_route(@role, "work-related") %></small>
			        <% end %>
		        </h3>
			      
			      <% if private_mode_conditional && !@preview %>
			        <%= @role.role_experience %>
		        <% else %>
		          <% if @role.role_experience.empty? %>
		            This user has not listed any experience.
		          <% else %>
		            <%= @role.role_experience %>
		          <% end %>
	          <% end %>
			      
			      <hr>
	      </section>
	      
	      <section id="skills">
			      <h3>
			        <em>Skills</em>
			        
			        <% if private_mode_conditional && !@preview %>
			          <small class="pull-right"><%= link_to "Edit", edit_role_route(@role, "work-related") %></small>
			        <% end %>
		        </h3>
			      
			      <% if private_mode_conditional && !@preview %>
			        <%= @role.role_skills %>
		        <% else %>
		          <% if @role.role_skills.empty? %>
		            This user has not listed any skills.
		          <% else %>  
		            <%= @role.role_skills %>
		          <% end %>
	          <% end %>
			      
			      <hr>
			      
	      </section>
	    </div>
	    
	    <div class="row-fluid">
	      <section id="portfolio">
			      <h3><em>Portfolio</em><small class="pull-right"><%= link_to "View full portfolio", portfolio_route(@role) %></small></h3>
			      <hr>
			      <% if @portfolio_album.nil? and private_mode_conditional %>
			        You have no albums. <%= link_to "Create one?", new_media_collection_path(:role => @role.role_type), :class => "btn btn-info btn-mini" %>
			      <% elsif @portfolio_album.nil? %>
			        This user doesn't have a portfolio yet.
			      <% else %>
			        <div class="row-fluid">
			        <% for asset in @portfolio_album.media_assets.first(4) %>
			          <div class="span3">
					        <div class="well ir-media-thumbnail">
					          <% if asset.image? %>
						          <%= link_to image_tag(asset.media.url(:preview)), media_route(asset) %>
					          <% elsif asset.video? %>
						          <%= link_to image_tag("video_thumb.png"), media_route(asset) %>
					          <% elsif asset.audio? %>
					            <%= link_to image_tag("audio_thumb.png"), media_route(asset) %>
					          <% end %>
					        </div>
				        </div>
			        <% end %>
			        </div>
			      <% end %>
			      <hr />
	      </section>
	      
	      <section id="projects">
		      <h3><em>Projects</em><small class="pull-right"><%= link_to "View all projects", projects_route(@role) %></small></h3>
		      
		      <hr>
	      </section>    
	    </div>
    </div>
  </div>
</div>
